library(dplyr)
library(readxl)
data <- read_xlsx('data/raw_data/28_std_chronos_expnegdtr_PCA_30052022_FranciscoZambrano.xlsx')
data <- read_xlsx('data/raw_data/28_std_chronos_expnegdtr_PCA_30052022_FranciscoZambrano.xlsx')
data
library(tidyr)
data |>
pivot_longer(AGU:VNE,names_to = 'crono')
library(ggplot2)
data |>
pivot_longer(AGU:VNE,names_to = 'crono') |>
ggplot(.,aes(yrs,value,colour=crono)) +
geom_point()
data |>
pivot_longer(AGU:VNE,names_to = 'crono') |>
ggplot(aes(yrs,value,colour=crono)) +
geom_point()
data |>
pivot_longer(AGU:VNE,names_to = 'crono') |>
ggplot(aes(yrs,value,colour=crono)) +
geom_point() +
geom_line()
coord <- read_xlsx('data/raw_data/28_std_chronos_expnegdtr_PCA_30052022_FranciscoZambrano.xlsx',sheet = 2)
coord
library(sf)
coord <- st_as_sf(coord,coords = c'Lon','Lat',crs=4326)
coord <- st_as_sf(coord,coords = c('Lon','Lat'),crs=4326)
coord
data |>
pivot_longer(AGU:VNE,names_to = 'sites') |>
left_join(coord,by ='sites')
data$yrs
st_coordinates(coor)
st_coordinates(coord)
data
st_as_sf(coord,coords = c('Lon','Lat'),crs=4326) |> cbind(st_coordinates(coord))
coord <- st_as_sf(coord,coords = c('Lon','Lat'),crs=4326) |> cbind(st_coordinates(coord))
data |>
pivot_longer(AGU:VNE,names_to = 'sites') |>
left_join(coord,by ='sites') |>
ggplot() +
ggplot(aes(yrs,value,colour=crono)) +
geom_point() +
geom_line() +
facet_grid(~Y)
data |>
pivot_longer(AGU:VNE,names_to = 'sites') |>
left_join(coord,by ='sites') |>
ggplot() +
ggplot(aes(yrs,value,colour=crono)) +
geom_point() +
geom_line()
data |>
pivot_longer(AGU:VNE,names_to = 'sites') |>
left_join(coord,by ='sites') |>
ggplot(_) +
ggplot(aes(yrs,value,colour=crono)) +
geom_point() +
geom_line() +
facet_grid(~Y)
data |>
pivot_longer(AGU:VNE,names_to = 'sites') |>
left_join(coord,by ='sites')
data |>
pivot_longer(AGU:VNE,names_to = 'sites') |>
left_join(coord,by ='sites') |>
ggplot(aes(yrs,value,colour=crono)) +
geom_point() +
geom_line() +
facet_grid(~Y)
data |>
pivot_longer(AGU:VNE,names_to = 'sites') |>
left_join(coord,by ='sites') |>
ggplot(aes(yrs,value,colour=sites)) +
geom_point() +
geom_line() +
facet_grid(~Y)
data |>
pivot_longer(AGU:VNE,names_to = 'sites') |>
left_join(coord,by ='sites') |>
ggplot(aes(yrs,value,colour=sites)) +
geom_point() +
geom_line() +
facet_grid(Y~.)
data |>
pivot_longer(AGU:VNE,names_to = 'sites') |>
left_join(coord,by ='sites') |>
ggplot(aes(yrs,value,colour=sites)) +
geom_point(size=.2) +
geom_line(size=.2) +
facet_grid(Y~.,scales = 'free')
library(ggridges)
library(readxl)
library(fs)
library(sf)
library(stars)
library(dplyr)
library(tidyr)
library(broom)
infoDendro <- read_xlsx(dir_ls('data/',recurse = TRUE)[5],2)
infoDendro
denCoor <- st_as_sf(infoDendro,coords =c('Lon','Lat'),crs =4326)
denCoor <- st_transform(denCoor,32719)
dir <- '/mnt/HDD4TB_2/data/rasters/Procesados/MODIS/zcNDVIeos.MOD13Q1.006.chl'
zcndvi <- read_stars(dir_ls(dir,regexp = '*.tif$'))
data_dendro <- read_xlsx(dir_ls('data/',recurse = TRUE)[5],1) |>
pivot_longer(2:29,names_to='sites',values_to = 'PC') |>
rename(years = yrs) |>
filter(years >= 2002)
data_dendro
read_xlsx(dir_ls('data/',recurse = TRUE)[5],1)
denCoor <- st_as_sf(infoDendro,coords =c('Lon','Lat'),crs =4326)
denCoor <- st_transform(denCoor,32719)
library(mapview)
mapview(denCoor)
library(agrometR)
data("estaciones_agromet"')
data("estaciones_agromet")
estaciones_agromet
library(RCurl)
library(XML)
library(httr)
library(curl)
type <- c('MOLA','MOLT','MOTA')[2]
product <- 'MOD13Q1.061'
dir_out <- '/mnt/raster_raw/MODIS/'
updt_modis(type,product,dir_out)
URL <- paste0("https://e4ftl01.cr.usgs.gov/",type,"/",product,'/')
library(RCurl)
library(XML)
library(httr)
library(curl)
type <- c('MOLA','MOLT','MOTA')[2]
product <- 'MOD13Q1.061'
dir_out <- '/mnt/raster_raw/MODIS/'
list_files(dir_out)
list.files(dir_out)
type <- c('MOLA','MOLT','MOTA')[2]
product <- 'MOD13Q1.061'
dir_out <- '/mnt/raster_raw/MODIS/'
updt_modis(type,product,dir_out)
updt_modis <- function(type,product,dir_out){
URL <- paste0("https://e4ftl01.cr.usgs.gov/",type,"/",product,'/')
htmlContent <- RCurl::getURL(URL)
htmlTree <- XML::htmlParse(htmlContent)
links <- XML::xpathSApply(htmlTree, "//a/@href")
datesWeb <- as.character(unlist(regmatches(links,gregexpr("[0-9]{4}.[0-9]{2}.[0-9]{2}",links))))
if (dir.exists(file.path(dir_out,product))){
datesDir <- list.files(file.path(dir_out,product))
} else {
dir.create(file.path(dir_out,product))
datesDir <- character(0)
}
datesUpdate <- datesWeb[!datesWeb %in% datesDir]
pb <- progress::progress_bar$new(
total = length(datesUpdate),
format = " Downloading data for date :date [:bar] :percent eta: :eta"
)
purrr::map(datesUpdate, function(dir){
pb$tick(tokens = list(date = dir))
htmlContent2 <- RCurl::getURL(paste0(URL,dir,'/'))
htmlTree2 <- XML::htmlParse(htmlContent2)
links2 <- XML::xpathSApply(htmlTree2, "//a/@href")
files <- unlist(regmatches(links2,gregexpr(paste0(substr(product,1,7),".*hdf$"),links2)))
filesInd <- grep(files,pattern='.*(h11v10|h11v11|h11v12|h12v12|h12v13|h13v13|h13v14|h14v14).*.hdf$')
files <- files[filesInd]
dir.create(paste0(dir_out,product,'/',dir,'/'))
purrr::map(files,function(name){
tryCatch(
httr::GET(url = paste0(URL,dir,'/',name),
config = httr::config(connecttimeout = 120),
authenticate("frzambra@gmail.com","29H1kc12"),
write_disk(paste0(dir_out,product,'/',dir,'/',name),
overwrite=TRUE),
progress()),
error = function(e) print(paste('Error:',e))
)
})
})
}
updt_modis(type,product,dir_out)
files1 <- list.files(paste0(dir_out,'MOD13Q1.006'))
files1
files2 <- list.files(paste0(dir_out,'MOD13Q1.061'))
files
files1
files2
files1 %in% files2
files1[files1 %in% files2]
files1[!files1 %in% files2]
type <- c('MOLA','MOLT','MOTA')[2]
product <- 'MOD11A2.061'
dir_out <- '/mnt/raster_raw/MODIS/'
updt_modis(type,product,dir_out)
URL <- paste0("https://e4ftl01.cr.usgs.gov/",type,"/",product,'/')
htmlContent <- getURL(URL)
htmlTree <- htmlParse(htmlContent)
links <- xpathSApply(htmlTree, "//a/@href")
datesWeb <- as.character(unlist(regmatches(links,gregexpr("[0-9]{4}.[0-9]{2}.[0-9]{2}",links))))
if (dir.exists(file.path(dir.out,product))){
datesDir <- list.files(file.path(dir.out,product))
} else {
dir.create(file.path(dir.out,product))
datesDir <- character(0)
}
type <- c('MOLA','MOLT','MOTA')[2]
product <- 'MOD16A2.061'
dir_out <- '/mnt/raster_raw/MODIS/'
updt_modis(type,product,dir_out)
library(RCurl)
library(XML)
library(httr)
library(curl)
type <- c('MOLA','MOLT','MOTA')[2]
product <- 'MOD16A2GF.061'
dir_out <- '/mnt/raster_raw/MODIS/'
updt_modis(type,product,dir_out)
